<html><head><script>var canvas, ctx, runtext, output, scroll, playbut;var added_poly_point, moved_object, started_new_poly, added_agent, add_goal, remove_goal, cpp_progress, set_goal;function init() {    canvas = document.getElementById("canvas")    ctx = canvas.getContext("2d")    runtext = document.getElementById("runtext")    output = document.getElementById("output")    scroll = document.getElementById("scroll")    playbut = document.getElementById("play")    Module.ccall('cpp_start', null);    added_poly_point = Module.cwrap('added_poly_point', null, ['number', 'number']);    moved_object = Module.cwrap('moved_object', null, ['number', 'number', 'number']);     started_new_poly = Module.cwrap('started_new_poly', null)    added_agent = Module.cwrap('added_agent', null, ['number', 'number'])    add_goal = Module.cwrap('add_goal', 'number', ['number', 'number'])    remove_goal = Module.cwrap('remove_goal', null, ['number'])    set_goal = Module.cwrap('set_goal', null, ['number', 'number'])    cpp_progress = Module.cwrap('cpp_progress', null, ['number'])        canvas.onmousedown = handleMouseDown;    document.onmouseup = handleMouseUp;    document.onmousemove = handleMouseMove;    canvas.ondblclick = handleDblClick;    canvas.onclick = handleClick;        progress();}var drawObjects = {} // zOrder -> {ptr -> objects}var objects = {} // ptr -> objectvar selectedObject = null; // object that is currently pressed down// offset from the center of the object at the moment of mouse down so that the first move would not be jerkyvar mouseDownOffset = {x:0, y:0} ;var addingPoly = false;var addingAgent = false;var selectSquare = null; // x1, y1, x2, y2, isActivevar multiSelected = []; // objects that were multi selectedvar activeGoals = {}; // ptr -> truefunction handleMouseDown(event) {    var x = event.clientX - canvas.offsetLeft;    var y = event.clientY - canvas.offsetTop;    for(z in drawObjects) {        for(p in drawObjects[z]) {            var o = drawObjects[z][p];            if (o.isInside(x, y)) {                selectedObject = o;                mouseDownOffset.x = selectedObject.x - x                mouseDownOffset.y = selectedObject.y - y                return false;            }                    }    }    if (addingPoly) {        added_poly_point(x, y)        return false;    }    if (addingAgent) {        added_agent(x, y)        return false;    }    if (!selectSquare) {        selectSquare = {x1:x, y1:y, x2:x, y2:y}        return false;    }        return false // prevent cursor change}function handleClick(event) {}function clearMultiSel() {    multiSelected = []    for(i in objects) {        objects[i].isSelected = false;    }}function handleDblClick(event) {    clearMultiSel()    return false;}function handleMouseUp(event) {    selectedObject = null    if (selectSquare && !selectSquare.isActive &&  multiSelected.length > 0) {        var x = event.clientX - canvas.offsetLeft;        var y = event.clientY - canvas.offsetTop;        setGoal(x, y, multiSelected);    }        selectSquare = null;    return false;}function handleMouseMove(event) {    var x = event.clientX - canvas.offsetLeft;    var y = event.clientY - canvas.offsetTop;    if (selectSquare) {        selectSquare.x2 = x;        selectSquare.y2 = y;        selectSquare.xmin = Math.min(selectSquare.x1, selectSquare.x2);        selectSquare.ymin = Math.min(selectSquare.y1, selectSquare.y2);        selectSquare.width = Math.abs(selectSquare.x1 - selectSquare.x2);        selectSquare.height = Math.abs(selectSquare.y1 - selectSquare.y2)        if (selectSquare.width > 10 &&  selectSquare.height > 10) {            clearMultiSel()            for(i in objects) {                if (objects[i].isInRect(selectSquare)) {                    selectSquare.isActive = true;                    multiSelected.push(objects[i])                    objects[i].isSelected = true;                }                else                     objects[i].isSelected = false;            }        }    }    if (selectedObject) {        selectedObject.x = x + mouseDownOffset.x;        selectedObject.y = y + mouseDownOffset.y;                moved_object(selectedObject.ptr, selectedObject.x, selectedObject.y)    }    //draw()    return false;}function out(s) {    //output.innerHTML += s + "<br>"    console.log(s);}function clear_objects() {    objects = {};}function remove_object(ptr) {    delete drawObjects[objects[ptr].zOrder][ptr]    delete objects[ptr];}function add_object(ptr, zOrder, obj) {    obj.ptr = ptr;    obj.zOrder = zOrder;    objects[ptr] = obj;    if (!(zOrder in drawObjects))        drawObjects[zOrder] = []        drawObjects[zOrder][ptr] = obj;}function setGoal(x, y, selAgents) {    var goalPtr = add_goal(x, y) // will do add_circle    activeGoals[goalPtr] = true    for(i in selAgents) {        selAgents[i].goalPtr = goalPtr        set_goal(selAgents[i].ptr, goalPtr);    }    var usedGoals = {}    for(i in objects) {        if (objects[i].goalPtr)            usedGoals[objects[i].goalPtr] = true    }    for(i in activeGoals) {        if (!(i in usedGoals)) {            remove_goal(i);            delete activeGoals[i];        }    }}function Circle(x, y, radius, color, multiSel) {    this.x = x;    this.y = y;    this.radius = radius;    this.color = color;    this.multiSel = multiSel;    this.isSelected = false;    this.goalPtr = null;}Circle.prototype.draw1 = function() {    if (this.isSelected) {        ctx.beginPath();        ctx.arc(this.x, this.y, this.radius + 4, 0, 2 * Math.PI, false);        ctx.lineWidth = 2;        ctx.strokeStyle = "rgb(80,80,255)";        ctx.stroke();    }}Circle.prototype.draw2 = function() {    if (this.isSelected) {        ctx.beginPath();        ctx.arc(this.x, this.y, this.radius + 3, 0, 2 * Math.PI, false);        ctx.fillStyle = "#ffffff";        ctx.fill()    }}Circle.prototype.draw3 = function() {    ctx.beginPath();    ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI, false);    ctx.fillStyle = this.color;    ctx.fill();    ctx.lineWidth = 0.5;    ctx.strokeStyle = '#000000';    ctx.stroke();}Circle.prototype.isInside = function(x, y) {    return (x >= this.x - this.radius && x <= this.x + this.radius          && y >= this.y - this.radius && y <= this.y + this.radius);}Circle.prototype.isInRect = function(rect) {    if (!this.multiSel)        return false;    return (this.x >= rect.xmin && this.x <= rect.xmin + rect.width &&            this.y >= rect.ymin && this.y <= rect.ymin + rect.height) }function add_circle(ptr, zOrder, x, y, radius, color, multiSelectable) {    add_object(ptr, zOrder, new Circle(x, y, radius, color, multiSelectable));}function Triangle(ax, ay, bx, by, cx, cy, color) {    this.ax = ax; this.ay = ay;    this.bx = bx; this.by = by;    this.cx = cx; this.cy = cy;    this.color = color}Triangle.prototype.draw1 = function() {    ctx.beginPath();    ctx.moveTo(this.ax, this.ay);    ctx.lineTo(this.bx, this.by);    ctx.lineTo(this.cx, this.cy);    ctx.lineTo(this.ax, this.ay);    ctx.fillStyle = this.color;    ctx.fill()    ctx.lineWidth = 0.5;    ctx.strokeStyle = 'rgb(50,50,150)';    ctx.stroke()}Triangle.prototype.draw2 = Triangle.prototype.draw3 = function() {}Triangle.prototype.isInside = function(x, y) {    return false;}Triangle.prototype.isInRect = function(rect) {    return false;}function add_tri(ptr, zOrder, ax, ay, bx, by, cx, cy) {    add_object(ptr, zOrder, new Triangle(ax, ay, bx, by, cx, cy, "rgb(205,205,255)"))}function move_object(ptr, x, y) {    o = objects[ptr];    o.x = x;    o.y = y;}function draw() {    ctx.clearRect(0, 0, canvas.width, canvas.height);    for(z in drawObjects) {        for(p in drawObjects[z]) {            drawObjects[z][p].draw1();        }        for(p in drawObjects[z]) {            drawObjects[z][p].draw2();        }        for(p in drawObjects[z]) {            drawObjects[z][p].draw3();        }            }        if (selectSquare) {        ctx.fillStyle = "rgba(0,0,70,0.2)"        ctx.fillRect(selectSquare.xmin, selectSquare.ymin, selectSquare.width, selectSquare.height);        ctx.setLineDash([5])        ctx.strokeRect(selectSquare.xmin, selectSquare.ymin, selectSquare.width, selectSquare.height);        ctx.setLineDash([])    }}function progress() {    cpp_progress(0.4);    draw();    window.requestAnimationFrame(progress)}function triggerPolyline() {    addingPoly = !addingPoly;    if (addingAgent && addingPoly) {        triggerAgent();        document.getElementById("checkboxAgent").checked = false    }        var label = document.getElementById("polyLabel")    if (addingPoly)        label.innerHTML = "End Polyline"    else        label.innerHTML = "Start Polyline"    started_new_poly();    }function triggerAgent() {    addingAgent = !addingAgent;    if (addingAgent && addingPoly) {        triggerPolyline();        document.getElementById("checkboxPoly").checked = false    }}</script><script src="js_main.js"></script><style>body { /* disable selection so the double click will not select */   -webkit-touch-callout: none;   -webkit-user-select: none;   -khtml-user-select: none;   -moz-user-select: none;   -ms-user-select: none;   user-select: none;}</style></head><body onload="init()">  <canvas id="canvas" width="1000" height="800" style="border:solid 1px;"></canvas>  <br>  <input id="play" type="button" value="Play" onclick="play()"/>  <input id="reload" type="button" value="Reload" onclick="reload()"/>  <input id="scroll" type="range" name="points" min="0" max="100" value="0" style="width:700px"/>  <br>  <input id="checkboxPoly" type="checkbox" onclick="triggerPolyline()"/><label id="polyLabel" for="checkboxPoly">Start Polyline</label>  <br>  <input id="checkboxAgent" type="checkbox" onclick="triggerAgent()"/><label id="agentLabel" for="checkboxAgent">Add Agents</label><!--  <iframe id="runtext" src="output.txt" style="display:none" onload=""></iframe> -->  <div id="output">Loading...</div></body></html>